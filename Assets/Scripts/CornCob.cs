using System.Collections.Generic;
using System.Linq;
using UnityEngine;

public class CornCob : MonoBehaviour
{
    public static Dictionary<int, CornCob> cornCobDictionary = new();
    public int id;
    public MeshRenderer renderer;
    void OnDestroy()
    {
        cornCobDictionary.Remove(id);
    }
    public static int getNextId()
    {
        int index = 0;
        while (true)
        {
            if (!cornCobDictionary.ContainsKey(index)) return index;
            index++;
        }
    }

    public static void registerCorn(CornCob newCornCob)
    {
        if (cornCobDictionary.ContainsValue(newCornCob)) return;
        newCornCob.id = getNextId();
        cornCobDictionary.Add(newCornCob.id, newCornCob);

    }

    public static bool registerCorn(CornCob newCornCob, int id)
    {
        if (cornCobDictionary.ContainsKey(id)) return false;
        newCornCob.id = id;
        cornCobDictionary.Add(id, newCornCob);
        return true;
    }

    public Dictionary<int, int> cornCobCornDict = new();
    public float proportion = 10;
    public const int numCornSpots = 954 / 6;

    Vector3 CornPos(int i)
    {
        if (i < 0 || i >= numCornSpots){
            Debug.Log("Out of range");
            return Vector3.zero;
        }

        return new Vector3(cornInfo[i*6], cornInfo[i*6+1], cornInfo[i*6+2]);
    }

    Vector3 CornEuler(int i)
    {
        if (i < 0 || i >= numCornSpots){
            Debug.Log("Out of range");
            return Vector3.zero;
        }

        return new Vector3(cornInfo[i*6+3], cornInfo[i*6+4], cornInfo[i*6+5]);
    }

    void Start()
    {
        for (int i = 0; i < numCornSpots; i++)
        {
            if (cornCobCornDict.ContainsKey(i))
            {
                //Get the corn
                Corn newCorn = Corn.cornDictionary[cornCobCornDict[i]];
                GameObject obj = newCorn.transform.gameObject;
                obj.transform.parent = this.transform;
                //remove the physics
                Destroy(obj.GetComponent<Rigidbody>());
                obj.GetComponent<BoxCollider>().enabled = false;
                //Set its positions, scale and rotation
                Vector3 pos = CornPos(i) * 10;
                pos.Scale(new Vector3(1f, 1f, 1f / 0.5f));
                newCorn.transform.localPosition = pos;
                newCorn.transform.localEulerAngles = CornEuler(i) * -57.5f;
                if (i == 0) Debug.Log(newCorn.transform.localScale);
                newCorn.transform.localScale = new Vector3(10, 10, 20f);
            }
        }
    }

    public bool hasCorn()
    {
        return cornCobCornDict.Count > 0;
    }

    public GameObject getRandomCornObject()
    {
        if (cornCobCornDict.Count == 0) return null;

        var (key, id) = cornCobCornDict.ElementAt(Random.Range(0, cornCobCornDict.Count));

        return Corn.cornDictionary[id].gameObject;
    }

    public bool RemoveCorn(int cornId)
    {
        int key = -1;
        foreach (var (pos, id) in cornCobCornDict)
            if (id == cornId)
            {
                key = pos;
                break;
            }
        return cornCobCornDict.Remove(key);
    }

    public void Show()
    {
        renderer.enabled = true;
        foreach ((var pos, var cornId) in cornCobCornDict)
        {
            if (Corn.cornDictionary.TryGetValue(cornId, out var cornScript))
            {
                cornScript.Show();
            }
        }
    }

    public void Hide()
    {
        renderer.enabled = false;
        foreach ((var pos, var cornId) in cornCobCornDict)
            if (Corn.cornDictionary.TryGetValue(cornId, out var cornScript))
                cornScript.Hide();
    }

    public bool IsHidden()
    {
        return !renderer.enabled;
    }

    public static float[] cornInfo = new float[numCornSpots * 6]
    {
        0.0429f,    -0.1037f,     0.0326f,    3.1416f,    -0.0117f,     0.3739f,
        0.0809f,    -0.0777f,     0.0326f,    3.1416f,    -0.0117f,     0.7868f,
        0.1055f,    -0.0382f,     0.0326f,    3.1416f,    -0.0117f,     1.2053f,
        0.1121f,     0.0040f,     0.0326f,    3.1416f,    -0.0117f,     1.5880f,
        0.1000f,     0.0509f,     0.0326f,    3.1416f,    -0.0117f,     2.0230f,
        0.0763f,     0.0822f,     0.0326f,    3.1416f,    -0.0117f,     2.3751f,
        -0.0424f,    -0.1038f,     0.0326f,    3.1416f,    -0.0117f,    -0.4063f,
        -0.0806f,    -0.0781f,     0.0326f,    3.1416f,    -0.0117f,    -0.8196f,
        0.0407f,     0.1045f,     0.0326f,    3.1416f,    -0.0117f,     2.7517f,
        -0.0032f,     0.1121f,     0.0326f,    3.1416f,    -0.0117f,     3.1518f,
        -0.0447f,     0.1029f,     0.0326f,    3.1416f,    -0.0117f,    -2.7499f,
        -0.0779f,     0.0807f,     0.0326f,    3.1416f,    -0.0117f,    -2.3926f,
        -0.1026f,     0.0455f,     0.0326f,    3.1416f,    -0.0117f,    -2.0066f,
        -0.1121f,     0.0030f,     0.0326f,    3.1416f,    -0.0117f,    -1.6163f,
        -0.1057f,    -0.0376f,     0.0326f,    3.1416f,    -0.0117f,    -1.2472f,
        -0.1057f,    -0.0376f,     0.0326f,    3.1416f,    -0.0117f,    -1.2472f,
        -0.1121f,     0.0030f,     0.0326f,    3.1416f,    -0.0117f,    -1.6163f,
        -0.1026f,     0.0455f,     0.0326f,    3.1416f,    -0.0117f,    -2.0066f,
        -0.0779f,     0.0807f,     0.0326f,    3.1416f,    -0.0117f,    -2.3926f,
        -0.0447f,     0.1029f,     0.0326f,    3.1416f,    -0.0117f,    -2.7499f,
        -0.0032f,     0.1121f,     0.0326f,    3.1416f,    -0.0117f,     3.1518f,
        0.0407f,     0.1045f,     0.0326f,    3.1416f,    -0.0117f,     2.7517f,
        -0.0806f,    -0.0781f,     0.0326f,    3.1416f,    -0.0117f,    -0.8196f,
        -0.0424f,    -0.1038f,     0.0326f,    3.1416f,    -0.0117f,    -0.4063f,
        0.0763f,     0.0822f,     0.0326f,    3.1416f,    -0.0117f,     2.3751f,
        0.1000f,     0.0509f,     0.0326f,    3.1416f,    -0.0117f,     2.0230f,
        0.1121f,     0.0040f,     0.0326f,    3.1416f,    -0.0117f,     1.5880f,
        0.1055f,    -0.0382f,     0.0326f,    3.1416f,    -0.0117f,     1.2053f,
        0.0809f,    -0.0777f,     0.0326f,    3.1416f,    -0.0117f,     0.7868f,
        0.0429f,    -0.1037f,     0.0326f,    3.1416f,    -0.0117f,     0.3739f,
        -0.0011f,    -0.1122f,     0.0326f,    3.1416f,    -0.0117f,    -0.0279f,
        0.0049f,    -0.1121f,     0.0215f,    3.1416f,    -0.0117f,     0.0253f,
        0.0484f,    -0.1012f,     0.0215f,    3.1416f,    -0.0117f,     0.4272f,
        0.0849f,    -0.0733f,     0.0215f,    3.1416f,    -0.0117f,     0.8400f,
        0.1074f,    -0.0325f,     0.0215f,    3.1416f,    -0.0117f,     1.2586f,
        0.1117f,     0.0100f,     0.0215f,    3.1416f,    -0.0117f,     1.6413f,
        0.0971f,     0.0561f,     0.0215f,    3.1416f,    -0.0117f,     2.0763f,
        0.0718f,     0.0862f,     0.0215f,    3.1416f,    -0.0117f,     2.4283f,
        -0.0368f,    -0.1060f,     0.0215f,    3.1416f,    -0.0117f,    -0.3531f,
        -0.0763f,    -0.0822f,     0.0215f,    3.1416f,    -0.0117f,    -0.7663f,
        0.0351f,     0.1066f,     0.0215f,    3.1416f,    -0.0117f,     2.8050f,
        -0.0092f,     0.1118f,     0.0215f,    3.1416f,    -0.0117f,     3.2050f,
        -0.0501f,     0.1004f,     0.0215f,    3.1416f,    -0.0117f,    -2.6967f,
        -0.0821f,     0.0765f,     0.0215f,    3.1416f,    -0.0117f,    -2.3394f,
        -0.1048f,     0.0400f,     0.0215f,    3.1416f,    -0.0117f,    -1.9534f,
        -0.1121f,    -0.0029f,     0.0215f,    3.1416f,    -0.0117f,    -1.5631f,
        -0.1035f,    -0.0432f,     0.0215f,    3.1416f,    -0.0117f,    -1.1940f,
        -0.0096f,    -0.1118f,     0.0113f,    3.1416f,    -0.0117f,    -0.1038f,
        0.0349f,    -0.1066f,     0.0113f,    3.1416f,    -0.0117f,     0.2980f,
        0.0748f,    -0.0836f,     0.0113f,    3.1416f,    -0.0117f,     0.7109f,
        0.1023f,    -0.0460f,     0.0113f,    3.1416f,    -0.0117f,     1.1294f,
        0.1121f,    -0.0045f,     0.0113f,    3.1416f,    -0.0117f,     1.5121f,
        0.1036f,     0.0431f,     0.0113f,    3.1416f,    -0.0117f,     1.9471f,
        0.0823f,     0.0762f,     0.0113f,    3.1416f,    -0.0117f,     2.2992f,
        -0.0502f,    -0.1003f,     0.0113f,    3.1416f,    -0.0117f,    -0.4822f,
        -0.0863f,    -0.0717f,     0.0113f,    3.1416f,    -0.0117f,    -0.8955f,
        0.0485f,     0.1011f,     0.0113f,    3.1416f,    -0.0117f,     2.6758f,
        0.0053f,     0.1121f,     0.0113f,    3.1416f,    -0.0117f,     3.0759f,
        -0.0368f,     0.1060f,     0.0113f,    3.1416f,    -0.0117f,    -2.8258f,
        -0.0715f,     0.0864f,     0.0113f,    3.1416f,    -0.0117f,    -2.4685f,
        -0.0988f,     0.0531f,     0.0113f,    3.1416f,    -0.0117f,    -2.0825f,
        -0.1116f,     0.0115f,     0.0113f,    3.1416f,    -0.0117f,    -1.6922f,
        -0.1082f,    -0.0295f,     0.0113f,    3.1416f,    -0.0117f,    -1.3231f,
        -0.0935f,    -0.0619f,    -0.0007f,    3.1416f,    -0.0117f,    -1.0044f,
        -0.0619f,    -0.0936f,    -0.0007f,    3.1416f,    -0.0117f,    -0.6025f,
        -0.0191f,    -0.1105f,    -0.0007f,    3.1416f,    -0.0117f,    -0.1897f,
        0.0275f,    -0.1088f,    -0.0007f,    3.1416f,    -0.0117f,     0.2288f,
        0.0661f,    -0.0906f,    -0.0007f,    3.1416f,    -0.0117f,     0.6115f,
        0.0981f,    -0.0544f,    -0.0007f,    3.1416f,    -0.0117f,     1.0466f,
        0.1109f,    -0.0172f,    -0.0007f,    3.1416f,    -0.0117f,     1.3986f,
        -0.1098f,    -0.0230f,    -0.0007f,    3.1416f,    -0.0117f,    -1.3828f,
        -0.1098f,     0.0230f,    -0.0007f,    3.1416f,    -0.0117f,    -1.7960f,
        0.1094f,     0.0248f,    -0.0007f,    3.1416f,    -0.0117f,     1.7753f,
        0.0911f,     0.0655f,    -0.0007f,    3.1416f,    -0.0117f,     2.1753f,
        0.0602f,     0.0947f,    -0.0007f,    3.1416f,    -0.0117f,    -3.7264f,
        0.0233f,     0.1097f,    -0.0007f,    3.1416f,    -0.0117f,    -3.3691f,
        -0.0197f,     0.1104f,    -0.0007f,    3.1416f,    -0.0117f,    -2.9831f,
        -0.0603f,     0.0946f,    -0.0007f,    3.1416f,    -0.0117f,    -2.5928f,
        -0.0903f,     0.0665f,    -0.0007f,    3.1416f,    -0.0117f,    -2.2237f,
        -0.0903f,     0.0665f,    -0.0447f,    3.1416f,    -0.0117f,    -2.2237f,
        -0.0603f,     0.0946f,    -0.0447f,    3.1416f,    -0.0117f,    -2.5928f,
        -0.0197f,     0.1104f,    -0.0447f,    3.1416f,    -0.0117f,    -2.9831f,
        0.0233f,     0.1097f,    -0.0447f,    3.1416f,    -0.0117f,    -3.3691f,
        0.0602f,     0.0947f,    -0.0447f,    3.1416f,    -0.0117f,    -3.7264f,
        0.0911f,     0.0655f,    -0.0447f,    3.1416f,    -0.0117f,     2.1753f,
        0.1094f,     0.0248f,    -0.0447f,    3.1416f,    -0.0117f,     1.7753f,
        -0.1098f,     0.0230f,    -0.0447f,    3.1416f,    -0.0117f,    -1.7960f,
        -0.1098f,    -0.0230f,    -0.0447f,    3.1416f,    -0.0117f,    -1.3828f,
        0.1109f,    -0.0172f,    -0.0447f,    3.1416f,    -0.0117f,     1.3986f,
        0.0981f,    -0.0544f,    -0.0447f,    3.1416f,    -0.0117f,     1.0466f,
        0.0661f,    -0.0906f,    -0.0447f,    3.1416f,    -0.0117f,     0.6115f,
        0.0275f,    -0.1088f,    -0.0447f,    3.1416f,    -0.0117f,     0.2288f,
        -0.0191f,    -0.1105f,    -0.0447f,    3.1416f,    -0.0117f,    -0.1897f,
        -0.0619f,    -0.0936f,    -0.0447f,    3.1416f,    -0.0117f,    -0.6025f,
        -0.0935f,    -0.0619f,    -0.0447f,    3.1416f,    -0.0117f,    -1.0044f,
        -0.1082f,    -0.0295f,    -0.0328f,    3.1416f,    -0.0117f,    -1.3231f,
        -0.1116f,     0.0115f,    -0.0328f,    3.1416f,    -0.0117f,    -1.6922f,
        -0.0988f,     0.0531f,    -0.0328f,    3.1416f,    -0.0117f,    -2.0825f,
        -0.0715f,     0.0864f,    -0.0328f,    3.1416f,    -0.0117f,    -2.4685f,
        -0.0368f,     0.1060f,    -0.0328f,    3.1416f,    -0.0117f,    -2.8258f,
        0.0053f,     0.1121f,    -0.0328f,    3.1416f,    -0.0117f,     3.0759f,
        0.0485f,     0.1011f,    -0.0328f,    3.1416f,    -0.0117f,     2.6758f,
        -0.0863f,    -0.0717f,    -0.0328f,    3.1416f,    -0.0117f,    -0.8955f,
        -0.0502f,    -0.1003f,    -0.0328f,    3.1416f,    -0.0117f,    -0.4822f,
        0.0823f,     0.0762f,    -0.0328f,    3.1416f,    -0.0117f,     2.2992f,
        0.1036f,     0.0431f,    -0.0328f,    3.1416f,    -0.0117f,     1.9471f,
        0.1121f,    -0.0045f,    -0.0328f,    3.1416f,    -0.0117f,     1.5121f,
        0.1023f,    -0.0460f,    -0.0328f,    3.1416f,    -0.0117f,     1.1294f,
        0.0748f,    -0.0836f,    -0.0328f,    3.1416f,    -0.0117f,     0.7109f,
        0.0349f,    -0.1066f,    -0.0328f,    3.1416f,    -0.0117f,     0.2980f,
        -0.0096f,    -0.1118f,    -0.0328f,    3.1416f,    -0.0117f,    -0.1038f,
        -0.1035f,    -0.0432f,    -0.0226f,    3.1416f,    -0.0117f,    -1.1940f,
        -0.1121f,    -0.0029f,    -0.0226f,    3.1416f,    -0.0117f,    -1.5631f,
        -0.1048f,     0.0400f,    -0.0226f,    3.1416f,    -0.0117f,    -1.9534f,
        -0.0821f,     0.0765f,    -0.0226f,    3.1416f,    -0.0117f,    -2.3394f,
        -0.0501f,     0.1004f,    -0.0226f,    3.1416f,    -0.0117f,    -2.6967f,
        -0.0092f,     0.1118f,    -0.0226f,    3.1416f,    -0.0117f,     3.2050f,
        0.0351f,     0.1066f,    -0.0226f,    3.1416f,    -0.0117f,     2.8050f,
        -0.0763f,    -0.0822f,    -0.0226f,    3.1416f,    -0.0117f,    -0.7663f,
        -0.0368f,    -0.1060f,    -0.0226f,    3.1416f,    -0.0117f,    -0.3531f,
        0.0718f,     0.0862f,    -0.0226f,    3.1416f,    -0.0117f,     2.4283f,
        0.0971f,     0.0561f,    -0.0226f,    3.1416f,    -0.0117f,     2.0763f,
        0.1117f,     0.0100f,    -0.0226f,    3.1416f,    -0.0117f,     1.6413f,
        0.1074f,    -0.0325f,    -0.0226f,    3.1416f,    -0.0117f,     1.2586f,
        0.0849f,    -0.0733f,    -0.0226f,    3.1416f,    -0.0117f,     0.8400f,
        0.0484f,    -0.1012f,    -0.0226f,    3.1416f,    -0.0117f,     0.4272f,
        0.0049f,    -0.1121f,    -0.0226f,    3.1416f,    -0.0117f,     0.0253f,
        -0.0011f,    -0.1122f,    -0.0114f,    3.1416f,    -0.0117f,    -0.0279f,
        0.0429f,    -0.1037f,    -0.0114f,    3.1416f,    -0.0117f,     0.3739f,
        0.0809f,    -0.0777f,    -0.0114f,    3.1416f,    -0.0117f,     0.7868f,
        0.1055f,    -0.0382f,    -0.0114f,    3.1416f,    -0.0117f,     1.2053f,
        0.1121f,     0.0040f,    -0.0114f,    3.1416f,    -0.0117f,     1.5880f,
        0.1000f,     0.0509f,    -0.0114f,    3.1416f,    -0.0117f,     2.0230f,
        0.0763f,     0.0822f,    -0.0114f,    3.1416f,    -0.0117f,     2.3751f,
        -0.0424f,    -0.1038f,    -0.0114f,    3.1416f,    -0.0117f,    -0.4063f,
        -0.0806f,    -0.0781f,    -0.0114f,    3.1416f,    -0.0117f,    -0.8196f,
        0.0407f,     0.1045f,    -0.0114f,    3.1416f,    -0.0117f,     2.7517f,
        -0.0032f,     0.1121f,    -0.0114f,    3.1416f,    -0.0117f,     3.1518f,
        -0.0447f,     0.1029f,    -0.0114f,    3.1416f,    -0.0117f,    -2.7499f,
        -0.0779f,     0.0807f,    -0.0114f,    3.1416f,    -0.0117f,    -2.3926f,
        -0.1026f,     0.0455f,    -0.0114f,    3.1416f,    -0.0117f,    -2.0066f,
        -0.1121f,     0.0030f,    -0.0114f,    3.1416f,    -0.0117f,    -1.6163f,
        -0.1057f,    -0.0376f,    -0.0114f,    3.1416f,    -0.0117f,    -1.2472f,
        -0.1057f,    -0.0376f,    -0.0114f,    3.1416f,    -0.0117f,    -1.2472f,
        -0.1121f,     0.0030f,    -0.0114f,    3.1416f,    -0.0117f,    -1.6163f,
        -0.1026f,     0.0455f,    -0.0114f,    3.1416f,    -0.0117f,    -2.0066f,
        -0.0779f,     0.0807f,    -0.0114f,    3.1416f,    -0.0117f,    -2.3926f,
        -0.0447f,     0.1029f,    -0.0114f,    3.1416f,    -0.0117f,    -2.7499f,
        -0.0032f,     0.1121f,    -0.0114f,    3.1416f,    -0.0117f,     3.1518f,
        0.0407f,     0.1045f,    -0.0114f,    3.1416f,    -0.0117f,     2.7517f,
        -0.0806f,    -0.0781f,    -0.0114f,    3.1416f,    -0.0117f,    -0.8196f,
        -0.0424f,    -0.1038f,    -0.0114f,    3.1416f,    -0.0117f,    -0.4063f,
        0.0763f,     0.0822f,    -0.0114f,    3.1416f,    -0.0117f,     2.3751f,
        0.1000f,     0.0509f,    -0.0114f,    3.1416f,    -0.0117f,     2.0230f,
        0.1121f,     0.0040f,    -0.0114f,    3.1416f,    -0.0117f,     1.5880f,
        0.1055f,    -0.0382f,    -0.0114f,    3.1416f,    -0.0117f,     1.2053f,
        0.0809f,    -0.0777f,    -0.0114f,    3.1416f,    -0.0117f,     0.7868f,
        0.0429f,    -0.1037f,    -0.0114f,    3.1416f,    -0.0117f,     0.3739f,
        -0.0011f,    -0.1122f,    -0.0114f,    3.1416f,    -0.0117f,    -0.0279f
    };



}